---
layout: post
title: HTTP
description: >

sitemap: false
hide_last_modified: true
categories:
  - study
  - til
---

# REST API

### **Achivement Goals**

- REST API에 대해 이해할 수 있다.

  - REST API는 웹에서 사용되는 데이터나 자원(Resource)을 HTTP URI로 표현하고, HTTP 프로토콜을 통해 요청과 응답을 정의하는 방식
  - REST API 문서를 읽을 수 있다. (O)
  - REST API에 맞춰 디자인할 수 있다.

## **좋은 REST API를 디자인하는 방법**

REST API를 작성할 때는 몇 가지 지켜야 할 규칙들이 있습니다. 로이 필딩이 논문에서 제시한 REST 방법론을 보다 더 실용적으로 적용하기 위해 레오나르드 리차드슨은 REST API를 잘 적용하기 위한 4단계 모델을 만들었습니다.

리차드슨의 REST 성숙도 모델을 구조화하면 다음과 같습니다.

REST 성숙도 모델은 총 4단계(0~3단계)로 나누어집니다.

앞서 이야기한 로이 필딩은 이 모델의 모든 단계를 충족해야 REST API라고 부를 수 있다고 주장했습니다. 그러나 실제로 엄밀하게 3단계까지 지키기 어렵기 때문에 2단계까지만 적용해도 좋은 API 디자인이라고 볼 수 있고, 이런 경우 HTTP API 라고도 부릅니다.
![Untitled](https://s3.ap-northeast-2.amazonaws.com/urclass-images/9u2YISpdpWnz1JLxYbrF2-1634092735361.png)

### **REST 성숙도 모델 - 0단계**

REST 성숙도 모델에 따르면, 0단계에서는 단순히 HTTP 프로토콜을 사용하기만 해도 됩니다. 물론 이 경우, 해당 API를 REST API라고 할 수는 없으며, 0단계는 좋은 REST API를 작성하기 위한 기본 단계입니다.

단순히 HTTP 프로토콜을 사용하는 것이 REST API의 출발점입니다.

### **REST 성숙도 모델 - 1단계**

REST 성숙도 모델에 따르면, 1단계에서는 개별 리소스와의 통신을 준수해야 한다고 합니다.

조금 더 쉽게 말하면, 앞서 REST API는 웹에서 사용되는 모든 데이터나 자원(Resource)을 HTTP URI로 표현한다고 이야기했습니다. 그래서 모든 자원은 개별 리소스에 맞는 엔드포인트(Endpoint)를 사용해야 한다는 것과 요청하고 받은 자원에 대한 정보를 응답으로 전달해야 한다는 것이 1단계에서 의미하는 바입니다.

앞서 0단계에서는 모든 요청에서 엔드포인트로 `/appointment`를 사용하였습니다. 하지만 1단계에서는 요청하는 리소스가 무엇인지에 따라 각기 다른 엔드포인트로 구분하여 사용해야 합니다.

어떤 리소스를 변화시키는지 혹은 어떤 응답이 제공되는지에 따라 각기 다른 엔드포인트를 사용하기 때문에, 적절한 엔드포인트를 작성하는 것이 중요합니다.

엔드포인트 작성 시에는 동사, HTTP 메서드, 혹은 어떤 행위에 대한 단어 사용은 지양하고, 리소스에 집중해 명사 형태의 단어로 작성하는 것이 바람직 방법입니다.

더불어 요청에 따른 응답으로 리소스를 전달할 때에도 사용한 리소스에 대한 정보와 함께 리소스 사용에 대한 성공/실패 여부를 반환해야 합니다.

### **REST 성숙도 모델 - 2단계**

REST 성숙도 모델 2단계에서는 CRUD에 맞게 적절한 HTTP 메서드를 사용하는 것에 중점을 둡니다.

예를 들어 예약 가능한 시간을 확인한다는 것은 예약 가능한 시간을 조회(READ)하는 행위를 의미하고, 특정 시간에 약한다는 것은 해당 특정 시간에 예약을 생성(CREATE)한다는 것과 같습니다. 그렇기 때문에 조회(READ)하기 위해서는 `GET` 메서드를 사용하여 요청을 보내고, 이때 `GET` 메서드는 `body`를 가지지 않기 때문에 query parameter를 사용하여 필요한 리소스를 전달합니다.

또한 예약을 생성(CREATE)하기 위해서는 `POST` 메서드를 사용하여 요청을 보내는 것이 바람직합니다. 그리고 2단계에서는 `POST` 요청에 대한 응답이 어떻게 반환되는지도 중요합니다.

이 경우 응답은 새롭게 생성된 리소스를 보내주기 때문에, 응답 코드도 `201 Created` 로 명확하게 작성해야 하며, 관련 리소스를 클라이언트가 Location 헤더에 작성된 URI를 통해 확인할 수 있도록 해야, 완벽하게 REST 성숙도 모델의 2단계를 충족한 것이라고 볼 수 있습니다.

물론 메서드를 사용할 때도 규칙이 있습니다.

- `GET` 메서드 같은 경우는 서버의 데이터를 변화시키지 않는 요청에 사용해야 합니다.
- `POST` 는 요청마다 새로운 리소스를 생성하고 `PUT` 은 요청마다 같은 리소스를 반환합니다. 이렇게 매 요청마다 같은 리소스를 반환하는 특징을 멱등([idempotent](https://developer.mozilla.org/en-US/docs/Glossary/Idempotent))하다고 합니다. 그렇기 때문에 멱등성을 가지는 메서드 PUT과 그렇지 않은 POST는 구분하여 사용해야 합니다.
- `PUT` 과 `PATCH` 도 구분하여 사용해야 합니다. `PUT`은 교체, `PATCH`는 수정의 용도로 사용합니다.

  더 자세한 내용을 학습하고 싶다면 [MDN HTTP request methods](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods) 를 읽어보기 바랍니다.

API를 작성할 때, REST 성숙도 모델의 2단계까지 적용을 하면 대체적으로 잘 작성된 API라고 여깁니다. 물론 로이 필딩은 앞서 이야기한 바와 같이 3단계까지 만족하지 못한다면 REST API가 아니기 때문에 HTTP API라고 불러야 한다고 주장하지만, 뒤에 만나게 되는 레퍼런스의 모범적인 API 디자인조차도 REST 성숙도 모델의 3단계까지 적용한 경우는 극히 드뭅니다. 따라서 3단계까지 무조건적으로 모두 적용해야 한다는 것은 아닙니다.

### **REST 성숙도 모델 - 3단계**

마지막 단계는 HATEOAS(Hypertext As The Engine Of Application State)라는 약어로 표현되는 하이퍼미디어 컨트롤을 적용합니다. 3단계의 요청은 2단계와 동일하지만, 응답에는 리소스의 URI를 포함한 링크 요소를 삽입하여 작성한다는 것이 다릅니다.

이때 응답에 들어가게 되는 링크 요소는 응답을 받은 다음에 할 수 있는 다양한 액션들을 위해 많은 하이퍼미디어 컨트롤을 포함하고 있습니다.

예를 들어 허준이라는 의사의 예약 가능 시간을 확인한 후에는 그 시간대에 예약을 할 수 있는 링크를 삽입하거나, 특정 시간에 예약을 완료하고 나서는 그 예약을 다시 확인할 수 있도록 링크를 작성해 넣을 수도 있습니다. 이렇게 응답 내에 새로운 링크를 넣어 새로운 기능에 접근할 수 있도록 하는 것이 3단계의 중요 포인트입니다.

만약 클라이언트 개발자들이 응답에 담겨 있는 링크들을 눈여겨본다면, 이러한 링크들은 조금 더 쉽고, 효율적으로 리소스와 기능에 접근할 수 있게 하는 트리거가 될 수 있습니다.

이렇게 리차드슨의 REST 성숙도 모델을 통해 좋은 REST API를 작성하기 위한 규칙에 대해서 알아보았습니다. 규칙들을 통해 리소스 중심의 올바른 엔드포인트 작성, 적절한 응답 코드와 리소스에 대한 정보 기재, CRUD에 적합한 HTTP 메서드 사용 등을 고려해야 좋은 REST API를 디자인할 수 있다는 것을 배웠습니다.

다음에 주어지는 레퍼런스를 통해 실제로는 어떻게 REST API가 작성되고 있는지 확인해 보고, 좋은 REST API를 작성하기 위해서 REST 성숙도 모델의 단계를 어떻게 적용해야 하는지 체크포인트를 통해 고민해 보기 바랍니다.

- Open API와 API Key에 대해 이해할 수 있다.

  - 글자 그대로 누구에게나 열려있는 API입니다. 그러나 "무제한으로 이용할 수 있다"라는 의미는 아닙니다. 기관이나 API마다 정해진 이용 수칙이 있고, 그 이용 수칙에 따라 제한사항(가격, 정보의 제한 등)이 있을 수 있습니다.
  - API를 이용하기 위해서는 API Key가 필요합니다. API key는 서버의 문을 여는 열쇠라고 생각할 수 있습니다. 클라이언트의 요청에 따라 서버에서 응답한다는 말은 결국 서버를 운용하는 데에 비용이 발생한다는 말입니다. 따라서 서버 입장에서 아무런 조건 없이 익명의 클라이언트에게 데이터를 제공할 의무도, 이유도 없습니다. (가끔 API key가 필요하지 않은 경우도 있습니다.)

    그래서 로그인된 이용자에게만 자원에 접근할 수 있는 권한을 API Key의 형태로 제공하고, 데이터를 요청할 때 API key를 같이 전달해야만 원하는 응답을 받을 수 있습니다.

- Postman이 무엇인지 이해하고 사용할 수 있다. (O)
  - HTTP API 테스팅이 무엇인지 알 수 있다.
    - 테스트를 위해 GET이 아닌 다른 요청을 보내려면, 개발자 도구의 콘솔 창에서 내장 함수 `fetch`를 사용해야 합니다.
    - 매번 코드를 작성할 수는 있습니다. 그러나 테스트를 위해 매번 코드를 작성하는 건 상당히 번거로운 작업입니다. 매번 코드를 작성하는 것 대신에, HTTP 요청을 테스트할 수 있는 다양한 도구가 있습니다. 많은 API가 HTTP 프로토콜을 이용하므로, API 테스트 도구라고 부릅니다. 이러한 API 테스트 도구는 클라이언트 입장에서 서버 API를 테스트하거나, API를 만드는 과정에서도 매우 유용합니다.
  - Postman을 사용하여 서버에 GET, POST 요청을 보내고 응답을 받을 수 있다. (0)
  - (Optional) Postman을 사용하여 Open Weather Map Open API에 요청을 보낼 수 있다.

## 학습내용

- REST의 구체적인 개념

  - 리소스에 대한 주소를 정하는 법
  - 디자인 원리, 제약, 즉 규칙.

  HTTP URI(Uniform Resource Identifier)를 통해 자원(Resource)을 명시하고, HTTP Method(POST, GET, PUT, DELETE)를 통해 해당 자원에 대한 CRUD Operation을 적용하는 것을 의미한다.

- CRUD Operation

  Create : 생성(POST)
  Read : 조회(GET)
  Update : 수정(PUT)
  Delete : 삭제(DELETE)
  HEAD: header 정보 조회(HEAD)

- REST API에 대해 이해할 수 있다.

  - API(Application Programming Interface)란
    데이터와 기능의 집합을 제공하여 컴퓨터 프로그램간 상호작용을 촉진하며, 서로 정보를 교환가능 하도록 하는 것

    - REST API의 정의

      - REST 기반으로 서비스 API를 구현한 것
      - 최근 OpenAPI(누구나 사용할 수 있도록 공개된 API: 구글 맵, 공공 데이터 등), 마이크로 서비스(하나의 큰 애플리케이션을 여러 개의 작은 애플리케이션으로 쪼개어 변경과 조합이 가능하도록 만든 아키텍처) 등을 제공하는 업체 대부분은 REST API를 제공한다.

    - REST API 설계 기본 규칙
      <참고 리소스 원형> - 도큐먼트 : 객체 인스턴스나 데이터베이스 레코드와 유사한 개념 - 컬렉션 : 서버에서 관리하는 디렉터리라는 리소스 - 스토어 : 클라이언트에서 관리하는 리소스 저장소

    1. URI는 정보의 자원을 표현해야 한다.
       1. resoruce는 동사보다는 명사를, 대문자보다는 소문자를 사용
       2. 도큐먼트 이름으로는 단수명사를 사용
       3. 컬렉션 이름으로는 복수 명사
       4. 스토어 이름으로는 복수 명사
    2. 자원에 대한행위는 HTTP Method로 표현한다.
       1. URI에 HTTP Method가 들어가면 안된다.
       2. URI에 행위에 대한 동사 표현이 들어가면 안된다.
       3. 경로 부분 중 변하는 부분은 유일한 값으로 대체한다.

    - MIME TYPE
      - 웹에서 파일의 확장자는 별 의미가 없다. 그러므로 각 문서와 함께 올바른 MIME타입을 HTTP 헤더를 통해 보내야 한다.
      - 기본 형태 type/subtype
    - 개별타입 e.g 변해야 할 데이터가 정해지면 찾아서 형식만 확인.!
      - text
      - text/html
      - image/jpeg
      - audio/mpeg
      - audio/ogg
      - video/mp4
      - application/octec.steam
      - application/json
